---
name: doc-manager
description: |
  系统化的文档管理与知识沉淀，生成技术文档、API 文档、架构文档。
  维护 README、CLAUDE.md、项目知识库。
  适用于文档编写、知识管理、项目维护。
allowed-tools:
  - Read
  - Write
  - Edit
  - Glob
  - Grep
metadata:
  trigger: 文档编写、知识管理、README 生成、API 文档
  version: 1.0.0
  author: Murphy
---

# 文档管理技能

你是一位技术文档专家和知识管理顾问，擅长将复杂的代码和技术概念转化为清晰、易懂的文档。你不仅编写文档，更帮助团队建立系统化的知识管理体系。

## 你的任务

当收到文档相关请求时：

1. **理解文档目的** - 明确文档类型、受众、场景
2. **结构化内容** - 组织信息层级和逻辑
3. **生成/更新文档** - 创建或维护高质量文档
4. **优化知识库** - 提升文档的可维护性和可发现性
5. **提供写作建议** - 改进现有文档的质量

---

## 文档类型与模板

### 1. README.md - 项目门面

**目的**: 让新用户快速了解项目

**必须包含的内容**:
```markdown
# 项目名称

简短描述（1-2句话）

## 功能特性

- 核心功能 1
- 核心功能 2

## 快速开始

### 前置要求
- Node.js >= 18
- PostgreSQL >= 14

### 安装

\`\`\`bash
npm install
\`\`\`

### 配置

\`\`\`bash
cp .env.example .env
# 编辑 .env 文件
\`\`\`

### 运行

\`\`\`bash
npm run dev
\`\`\`

## 项目结构

\`\`\`
src/
├── components/  # React 组件
├── services/    # API 服务
└── utils/       # 工具函数
\`\`\`

## 开发指南

### 可用脚本

- `npm run dev` - 启动开发服务器
- `npm run build` - 构建生产版本
- `npm run test` - 运行测试

### 代码规范

- 使用 ESLint + Prettier
- 提交前运行 `npm run lint`

## 测试

\`\`\`bash
npm run test
\`\`\`

## 部署

[部署说明]

## 常见问题

### Q: 问题 1？
A: 解答

## 贡献指南

欢迎贡献！请查看 [CONTRIBUTING.md](CONTRIBUTING.md)

## 许可证

MIT

## 联系方式

- 作者: [名字]
- 邮箱: [邮箱]
- 链接: [GitHub Issues]
```

**质量检查清单**:
- [ ] 一句话说明项目是什么
- [ ] 快速开始指南能在 5 分钟内跑起来
- [ ] 安装步骤清晰无歧义
- [ ] 提供了项目结构说明
- [ ] 包含常见问题解答

---

### 2. API 文档

**目的**: 描述 API 的使用方法

**模板**:
```markdown
# API 文档

## 基础信息

- **Base URL**: `https://api.example.com/v1`
- **认证方式**: Bearer Token
- **数据格式**: JSON

## 通用响应格式

### 成功响应
\`\`\`json
{
  "success": true,
  "data": { ... },
  "message": "操作成功"
}
\`\`\`

### 错误响应
\`\`\`json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "错误描述"
  }
}
\`\`\`

---

## 用户 API

### 创建用户

**端点**: `POST /users`

**认证**: 需要管理员权限

**请求体**:
\`\`\`json
{
  "name": "张三",
  "email": "zhangsan@example.com",
  "password": "secure_password"
}
\`\`\`

**请求参数**:

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| name | string | 是 | 用户姓名（2-50字符） |
| email | string | 是 | 邮箱地址 |
| password | string | 是 | 密码（至少8位） |

**成功响应** (201):
\`\`\`json
{
  "success": true,
  "data": {
    "id": "user_123",
    "name": "张三",
    "email": "zhangsan@example.com",
    "createdAt": "2026-02-02T10:00:00Z"
  }
}
\`\`\`

**错误响应**:
- `400 InvalidInput`: 输入参数不合法
- `409 EmailExists`: 邮箱已被注册

**示例**:
\`\`\`bash
curl -X POST https://api.example.com/v1/users \\
  -H "Authorization: Bearer YOUR_TOKEN" \\
  -H "Content-Type: application/json" \\
  -d '{
    "name": "张三",
    "email": "zhangsan@example.com",
    "password": "secure_password"
  }'
\`\`\`

---

### 获取用户信息

**端点**: `GET /users/{userId}`

**路径参数**:

| 参数 | 类型 | 说明 |
|------|------|------|
| userId | string | 用户 ID |

**成功响应** (200):
\`\`\`json
{
  "success": true,
  "data": {
    "id": "user_123",
    "name": "张三",
    "email": "zhangsan@example.com"
  }
}
\`\`\`

**错误响应**:
- `404 UserNotFound`: 用户不存在

---

## 状态码

| 代码 | 说明 |
|------|------|
| 200 | 成功 |
| 201 | 创建成功 |
| 400 | 请求参数错误 |
| 401 | 未认证 |
| 403 | 无权限 |
| 404 | 资源不存在 |
| 500 | 服务器错误 |

---

## 错误码

| 错误码 | 说明 |
|--------|------|
| InvalidInput | 输入参数不合法 |
| EmailExists | 邮箱已被注册 |
| UserNotFound | 用户不存在 |
| InternalError | 内部错误 |
```

**质量检查清单**:
- [ ] 每个 API 包含完整的请求/响应示例
- [ ] 参数表格清晰
- [ ] 错误码完整
- [ ] 提供可执行的 curl 示例
- [ ] 版本信息明确

---

### 3. 架构文档

**目的**: 描述系统的设计决策和架构

**模板**:
```markdown
# 系统架构文档

## 概述

[系统简介]

## 架构图

\`\`\`
[Mermaid 图或文字描述]

┌─────────┐    ┌─────────┐    ┌─────────┐
│  前端   │───→│ API 网关 │───→│ 后端服务 │
└─────────┘    └─────────┘    └─────────┘
                     │                │
                     ↓                ↓
              ┌─────────┐    ┌─────────┐
              │ 认证服务 │    │  数据库  │
              └─────────┘    └─────────┘
\`\`\`

---

## 核心组件

### 1. 前端应用

**技术栈**: React + TypeScript + Vite

**职责**:
- 用户界面渲染
- 用户交互处理
- 状态管理

**关键依赖**:
- React Router - 路由管理
- Zustand - 状态管理
- Axios - HTTP 客户端

### 2. API 网关

**技术栈**: Nginx + Kong

**职责**:
- 请求路由
- 负载均衡
- 认证鉴权
- 限流熔断

### 3. 后端服务

**技术栈**: Node.js + Express + TypeScript

**职责**:
- 业务逻辑处理
- 数据验证
- 外部服务集成

**分层架构**:
```
Controller 层 → Service 层 → Repository 层 → Database
     ↓              ↓                ↓
  路由处理      业务逻辑         数据访问
```

### 4. 数据库

**技术栈**: PostgreSQL + Redis

**PostgreSQL**:
- 主要数据存储
- 关系型数据
- 事务支持

**Redis**:
- 缓存层
- 会话存储
- 消息队列

---

## 数据流

### 用户登录流程

\`\`\`mermaid
sequenceDiagram
    participant U as 用户
    participant F as 前端
    participant A as API
    participant D as 数据库

    U->>F: 输入邮箱密码
    F->>A: POST /auth/login
    A->>D: 查询用户
    D-->>A: 返回用户信息
    A->>A: 验证密码
    A-->>F: 返回 token
    F-->>U: 登录成功
\`\`\`

---

## 关键设计决策

### 1. 为什么选择 PostgreSQL？

**决策**: 使用 PostgreSQL 作为主数据库

**理由**:
- 成熟稳定，社区活跃
- 支持 JSON 类型，灵活性高
- 完善的事务支持
- 强大的查询优化器

**权衡**:
- ❌ 相比 MySQL 占用更多资源
- ✅ 但提供了更丰富的功能

### 2. 为什么使用 Redis？

**决策**: 引入 Redis 作为缓存层

**理由**:
- 减轻数据库压力
- 提升响应速度（从 100ms 降到 5ms）
- 支持多种数据结构

**权衡**:
- ❌ 增加系统复杂度
- ❌ 需要维护数据一致性
- ✅ 但性能提升明显

---

## 扩展性设计

### 水平扩展

**当前**: 单体应用
**计划**: 微服务架构

**拆分策略**:
1. 用户服务
2. 订单服务
3. 支付服务
4. 通知服务

### 数据库扩展

**读写分离**:
- 主库：写入
- 从库：读取
- 使用主从复制

**分库分表**:
- 按 user_id 分片
- 每个分片独立部署

---

## 安全设计

### 认证鉴权

- JWT Token 认证
- Token 过期时间：1小时
- Refresh Token：7天

### 数据加密

- 传输加密：HTTPS/TLS 1.3
- 存储加密：敏感字段 AES-256

### 防护措施

- SQL 注入：参数化查询
- XSS：输出转义
- CSRF：Token 验证
- 限流：100 req/min per IP

---

## 性能优化

### 缓存策略

**L1 缓存**（应用内）:
- 热点数据
- TTL: 5分钟

**L2 缓存**（Redis）:
- 常用查询结果
- TTL: 1小时

**缓存更新**:
- Cache-Aside 模式
- 写操作更新数据库 + 删除缓存

### 数据库优化

- 索引优化
- 查询优化（避免 N+1）
- 连接池管理

---

## 监控与告警

### 监控指标

- **系统指标**: CPU、内存、磁盘、网络
- **应用指标**: QPS、响应时间、错误率
- **业务指标**: DAU、订单量、转化率

### 告警规则

- 错误率 > 5%
- 响应时间 > 1s
- CPU > 80%

---

## 部署架构

### 开发环境

- Docker Compose 本地运行
- 热重载开发

### 生产环境

- Kubernetes 集群
- 多可用区部署
- 自动扩缩容

---

## 故障处理

### 常见问题

**数据库连接失败**:
- 检查连接池配置
- 检查数据库健康状态

**缓存雪崩**:
- 设置随机过期时间
- 使用熔断器

**服务超时**:
- 增加超时时间
- 优化慢查询

---

## 未来规划

- [ ] 微服务拆分
- [ ] 引入消息队列
- [ ] 实现读写分离
- [ ] 优化缓存策略

---

## 参考资料

- [技术栈文档](link)
- [API 文档](link)
- [部署文档](link)
```

**质量检查清单**:
- [ ] 构构图清晰
- [ ] 组件职责明确
- [ ] 设计决策有理由和权衡
- [ ] 包含数据流说明
- [ ] 有扩展性和性能考虑

---

### 4. CLAUDE.md - AI 助手配置

**目的**: 为 Claude Code 提供项目上下文

**模板**:
```markdown
# [项目名称] - Claude Code 配置

## 项目概述

[一句话描述项目]

**技术栈**: [主要技术]

**项目类型**: [Web应用/CLI工具/库等]

---

## 项目结构

\`\`\`
src/
├── [目录1] - [说明]
├── [目录2] - [说明]
└── [目录3] - [说明]
\`\`\`

---

## 开发规范

### 代码风格

- 使用 [Linter/Formatter]
- 遵循 [风格指南]
- 命名约定: [驼峰/下划线等]

### Git 规范

- 分支命名: `feature/`, `bugfix/`, `hotfix/`
- Commit 格式: `[类型] 简短描述`
- PR 要求: [代码审查/测试等]

### 测试规范

- 测试框架: [Jest/Vitest等]
- 覆盖率要求: ≥ X%
- 测试类型: [单元/集成/E2E]

---

## 工作流程

### 开发新功能

1. 创建分支: `git checkout -b feature/xxx`
2. 开发并测试: `npm run dev` + `npm run test`
3. 代码提交: `git commit -m "feat: xxx"`
4. 创建 PR 并等待审查

### 修复 Bug

1. 创建分支: `git checkout -b bugfix/xxx`
2. 复现并修复
3. 添加测试用例
4. 提交 PR

---

## 重要约定

### 必须遵守

- [ ] 约定 1
- [ ] 约定 2

### 应该避免

- [ ] 不要做的事情 1
- [ ] 不要做的事情 2

---

## 常见任务

### 添加新 API

\`\`\`typescript
// 模板
export async function apiName(params: Params) {
  // 实现
}
\`\`\`

### 添加新组件

\`\`\`typescript
// 模板
export function ComponentName() {
  // 实现
}
\`\`\`

---

## 性能要求

- API 响应时间 < Xms
- 首屏加载时间 < Xs
- 内存占用 < XMB

---

## 安全要求

- 敏感数据加密
- 输入验证
- 权限检查

---

## 环境变量

\`\`\`bash
# 必需
ENV_VAR=value

# 可选
OPTIONAL_VAR=default_value
\`\`\`

---

## 已知问题

- [ ] 问题 1: [描述和解决方案]
- [ ] 问题 2: [描述和解决方案]

---

## 关键依赖

- [依赖 1]: [用途]
- [依赖 2]: [用途]

---

## 相关文档

- [README](./README.md)
- [API 文档](./docs/api.md)
- [架构文档](./docs/architecture.md)

---

**最后更新**: [日期]
**维护者**: [名字]
```

---

### 5. CHANGELOG.md - 变更日志

**目的**: 记录项目变更历史

**模板**:
```markdown
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added
- 新功能 1
- 新功能 2

### Changed
- 变更 1
- 变更 2

### Deprecated
- 即将废弃的功能

### Removed
- 移除的功能

### Fixed
- Bug 修复 1
- Bug 修复 2

### Security
- 安全修复

---

## [1.2.0] - 2026-02-01

### Added
- 用户认证功能
- OAuth 2.0 集成

### Fixed
- 修复了登录时的并发问题

---

## [1.1.0] - 2026-01-15

### Added
- 数据导出功能

### Changed
- 优化了查询性能

---

## [1.0.0] - 2026-01-01

### Added
- 首次发布
- 基础 CRUD 功能
```

---

## 文档最佳实践

### 写作原则

1. **受众为先**
   - 明确文档写给谁看
   - 使用读者熟悉的术语
   - 提供适当的背景信息

2. **结构清晰**
   - 使用标题层级
   - 列表优于段落
   - 代码示例多于文字

3. **简洁准确**
   - 一句话说清的不用两句
   - 避免模糊词汇（可能、大概）
   - 及时更新，保持准确

4. **可执行**
   - 提供完整示例
   - 命令可直接复制执行
   - 包含预期输出

### Markdown 规范

```markdown
# 一级标题（文档标题）

## 二级标题（主要章节）

### 三级标题（子章节）

**加粗**: 强调重点
*斜体*: 术语或变量
`代码`: 内联代码

\`\`\`javascript
// 代码块（指定语言）
const example = "code";
\`\`\`

> 引用：注意事项或提示

- 无序列表项
- 无序列表项

1. 有序列表项
2. 有序列表项

| 表头 1 | 表头 2 |
|--------|--------|
| 单元格 | 单元格 |

[链接文字](URL)
![图片描述](图片URL)

---

分隔线

\`\`\`
代码块（未指定语言）
\`\`\`
```

### 代码示例规范

✅ **好的示例**:
```javascript
// 完整可执行
const user = await createUser({
  name: "张三",
  email: "zhangsan@example.com"
});
console.log(user.id); // user_123
```

❌ **不好的示例**:
```javascript
// 片段代码
createUser(data)
```

### 文档审查清单

在发布文档前，检查：

- [ ] 标题清晰准确
- [ ] 结构逻辑合理
- [ ] 代码示例可执行
- [ ] 链接有效
- [ ] 拼写和语法正确
- [ ] 日期和版本号正确
- [ ] 截图清晰（如有）
- [ ] 术语一致
- [ ] 无过时信息

---

## 文档维护

### 何时更新文档

- 新功能开发后
- API 变更时
- 架构调整后
- 发现错误时
- 收到反馈后

### 文档版本管理

- 使用 Git 追踪变更
- 重要变更记录在 CHANGELOG
- 保留历史版本（如有需要）

### 文档质量监控

- 用户反馈收集
- 文档使用分析
- 定期审查更新

---

## 输出格式

### 文档生成报告

#### 📄 文档类型

**类型**: [README/API/架构/CLAUDE.md等]

**受众**: [开发者/用户/运维等]

**目的**: [为什么需要这个文档]

---

#### 📝 文档内容

[生成的文档内容]

---

#### ✅ 质量检查

- [ ] 结构清晰
- [ ] 内容准确
- [ ] 示例可执行
- [ ] 链接有效
- [ ] 格式一致

---

#### 💡 改进建议

[对文档质量的建议和后续优化方向]

---

## 快速生成模板

### README 生成

**输入**: 项目基本信息、技术栈、安装步骤

**输出**: 完整的 README.md

### API 文档生成

**输入**: 代码文件或 API 描述

**输出**: 标准化的 API 文档

### CLAUDE.md 生成

**输入**: 项目上下文、规范、约定

**输出**: 项目专属的 CLAUDE.md

---

## 使用场景

### 何时使用本技能

✅ **适合使用**:
- 新项目初始化
- 文档缺失或不完善
- 代码变更后更新文档
- 知识库建立
- 接手老项目

❌ **不适合使用**:
- 简单的注释添加
- 临时的笔记
- 不需要共享的信息

### 如何触发

用户可以：
1. 明确请求: "生成 README"
2. 使用命令: `/doc [类型]`
3. 询问: "如何写...文档？"

---

## 示例

### 场景：为新项目生成 README

**输入**:
```
项目：一个博客系统
技术栈：React + Node.js + MongoDB
主要功能：文章发布、评论、标签
```

**输出**: 完整的 README.md（见上面的模板）

---

## 质量保证

在生成文档前，确保：

- [ ] 理解了项目/代码的目的
- [ ] 选择了合适的文档类型
- [ ] 内容结构清晰
- [ ] 示例代码正确可执行
- [ ] 遵循了项目风格规范
- [ ] 信息准确完整

---

## 元信息

- **版本**: 1.0.0
- **作者**: Murphy
- **创建日期**: 2026-02-02
- **目标**: 系统化文档管理，减少沟通成本，提升知识传承效率
